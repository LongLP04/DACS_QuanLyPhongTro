@model DACS_QuanLyPhongTro.Models.HoaDon

@{
    ViewData["Title"] = "Thanh toán hóa đơn";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h3>@ViewData["Title"]</h3>

<div class="card">
    <div class="card-body">
        <!-- Thông tin chi tiết hóa đơn -->
        <p><strong>Phòng:</strong> @Model.PhongTro.SoPhong</p>
        <p><strong>Ngày lập:</strong> @Model.NgayLap.ToString("dd/MM/yyyy")</p>
        <p><strong>Tổng tiền:</strong> @Model.TongTien.ToString("N0") VND</p>
        <p><strong>Trạng thái:</strong> @Model.TrangThai</p>

        <!-- Phương thức thanh toán -->
        <div class="payment-method-container">
            <h5>Phương thức thanh toán</h5>
            <div class="payment-method-options">
                @foreach (var pt in ViewBag.PhuongThuc as List<DACS_QuanLyPhongTro.Models.PhuongThucThanhToan>)
                {
                    <div class="payment-method" style="cursor: pointer;" onclick="selectPaymentMethod(@pt.MaPhuongThuc, '@pt.TenPhuongThuc')">
                        <img src="@Url.Content("~/images/" + pt.TenPhuongThuc + ".png")" alt="@pt.TenPhuongThuc" class="payment-method-img" />
                        <p>@pt.TenPhuongThuc</p>
                    </div>
                }
            </div>
        </div>

        <form method="post" asp-action="XacNhanThanhToan" asp-route-id="@Model.MaHoaDon">
            <input type="hidden" name="maPhuongThuc" id="selectedPaymentMethod" />

            <!-- Hiển thị hộp xác nhận khi chọn phương thức thanh toán -->
            <div id="confirmation" style="display:none;">
                <p id="confirmationMessage"></p>
                <button type="submit" class="btn btn-success">Xác nhận thanh toán</button>
                <button type="button" class="btn btn-secondary" onclick="cancelPayment()">Hủy</button>
            </div>
        </form>
    </div>
</div>

    <style>
        .payment-method-container {
            margin-top: 20px;
        }

        .payment-method-options {
            display: flex;
            justify-content: flex-start; /* Căn các phần tử về bên trái */
            margin-top: 10px;
        }

        .payment-method {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 120px; /* Chiều rộng cố định cho mỗi ô */
            text-align: center;
            margin: 10px;
            cursor: pointer;
        }

        .payment-method-img {
            width: 80px; /* Kích thước ảnh nhỏ hơn */
            height: 80px; /* Kích thước ảnh nhỏ hơn */
            object-fit: contain;
        }

        .payment-method img {
            max-width: 100%;
            max-height: 100%;
        }
    </style>


@section Scripts {
    <script>
        let selectedMethodId = null;

        // Hàm chọn phương thức thanh toán
        function selectPaymentMethod(methodId, methodName) {
            // Cập nhật id của phương thức thanh toán đã chọn
            selectedMethodId = methodId;
            document.getElementById("selectedPaymentMethod").value = selectedMethodId;

            // Hiển thị hộp xác nhận thanh toán với tên phương thức đã chọn
            document.getElementById("confirmationMessage").innerText = "Bạn có chắc chắn muốn thanh toán bằng phương thức " + methodName + " không?";
            document.getElementById("confirmation").style.display = 'block';
        }

        // Hủy thanh toán
        function cancelPayment() {
            selectedMethodId = null;
            document.getElementById("confirmation").style.display = 'none';
        }
    </script>
}
